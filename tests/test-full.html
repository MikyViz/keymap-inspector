<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Keymap Inspector Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 3px;
            margin: 5px 0;
            font-family: monospace;
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .layout-item {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 3px;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Complete Keymap Inspector Test</h1>
        
        <div class="test-section">
            <h2>1. Layout Loading Test</h2>
            <div id="layoutTest"></div>
        </div>
        
        <div class="test-section">
            <h2>2. Character Inspection Test</h2>
            <div id="charTest"></div>
        </div>
        
        <div class="test-section">
            <h2>3. Interactive Test</h2>
            <input type="text" id="testInput" placeholder="Type any character..." maxlength="1" style="padding: 10px; font-size: 16px; width: 300px;">
            <div id="interactiveResult"></div>
        </div>
        
        <div class="test-section">
            <h2>4. Key Code Test</h2>
            <input type="text" id="keyInput" placeholder="Press any key..." style="padding: 10px; font-size: 16px; width: 300px;">
            <div id="keyResult"></div>
        </div>
    </div>

    <!-- Load Keymap Inspector -->
    <script src="../dist/keymap-inspector.umd.js"></script>
    
    <script>
        // Test 1: Layout Loading
        function testLayoutLoading() {
            const layoutTestDiv = document.getElementById('layoutTest');
            let html = '';
            
            // Check if KeymapInspector is available
            if (typeof KeymapInspector === 'undefined') {
                html += '<div class="test-result error">‚ùå KeymapInspector not loaded</div>';
                layoutTestDiv.innerHTML = html;
                return;
            }
            
            html += '<div class="test-result success">‚úÖ KeymapInspector loaded successfully</div>';
            
            // Check available layouts
            const layoutNames = ['en', 'ru', 'de', 'fr', 'es', 'ua', 'he'];
            const availableLayouts = {};
            
            layoutNames.forEach(name => {
                if (KeymapInspector[name]) {
                    const layoutSize = Object.keys(KeymapInspector[name]).length;
                    html += `<div class="test-result success">‚úÖ ${name.toUpperCase()} layout: ${layoutSize} characters</div>`;
                    availableLayouts[name] = KeymapInspector[name];
                } else {
                    html += `<div class="test-result error">‚ùå ${name.toUpperCase()} layout: not found</div>`;
                }
            });
            
            // Try to create inspector
            try {
                window.inspector = new KeymapInspector.KeymapInspector(availableLayouts);
                html += '<div class="test-result success">‚úÖ Inspector created successfully</div>';
                html += `<div class="test-result info">üìä Loaded ${Object.keys(availableLayouts).length} layouts</div>`;
            } catch (error) {
                html += `<div class="test-result error">‚ùå Failed to create inspector: ${error.message}</div>`;
            }
            
            layoutTestDiv.innerHTML = html;
        }
        
        // Test 2: Character Inspection
        function testCharacterInspection() {
            const charTestDiv = document.getElementById('charTest');
            let html = '';
            
            if (!window.inspector) {
                html += '<div class="test-result error">‚ùå Inspector not available</div>';
                charTestDiv.innerHTML = html;
                return;
            }
            
            // Test characters from different layouts
            const testChars = [
                { char: 'a', expected: 'EN' },
                { char: 'q', expected: 'EN' },
                { char: '–π', expected: 'RU' },
                { char: '—ã', expected: 'RU' },
                { char: '√§', expected: 'DE' },
                { char: '√©', expected: 'FR' },
                { char: '√±', expected: 'ES' },
                { char: '—ñ', expected: 'UA' },
                { char: '◊©', expected: 'HE' }
            ];
            
            testChars.forEach(test => {
                const result = window.inspector.inspect(test.char);
                if (result) {
                    html += `<div class="test-result success">‚úÖ '${test.char}' ‚Üí Key: ${result.keyDefinition.code}</div>`;
                    
                    // Show all layouts for this key
                    html += '<div class="layout-grid">';
                    for (const layout in result.layouts) {
                        const char = result.layouts[layout] || '‚àÖ';
                        html += `<div class="layout-item">${layout.toUpperCase()}: ${char}</div>`;
                    }
                    html += '</div>';
                } else {
                    html += `<div class="test-result error">‚ùå '${test.char}' not found</div>`;
                }
            });
            
            charTestDiv.innerHTML = html;
        }
        
        // Test 3: Interactive Test
        document.addEventListener('DOMContentLoaded', function() {
            const testInput = document.getElementById('testInput');
            const interactiveResult = document.getElementById('interactiveResult');
            
            testInput.addEventListener('input', function(e) {
                const char = e.target.value;
                if (!char || !window.inspector) return;
                
                const result = window.inspector.inspect(char);
                let html = '';
                
                if (result) {
                    html = `
                        <div class="test-result success">
                            <strong>Character:</strong> "${result.char}"<br>
                            <strong>Key:</strong> ${result.keyDefinition.code} (keyCode: ${result.keyDefinition.keyCode})<br>
                            <strong>Shift Key:</strong> ${result.keyDefinition.shiftKey ? 'Yes' : 'No'}
                        </div>
                        <div class="layout-grid">
                    `;
                    
                    for (const layout in result.layouts) {
                        const char = result.layouts[layout] || '‚àÖ';
                        html += `<div class="layout-item">${layout.toUpperCase()}: ${char}</div>`;
                    }
                    html += '</div>';
                } else {
                    html = `<div class="test-result error">Character "${char}" not found in any layout</div>`;
                }
                
                interactiveResult.innerHTML = html;
            });
            
            // Test 4: Key Code Test
            const keyInput = document.getElementById('keyInput');
            const keyResult = document.getElementById('keyResult');
            
            keyInput.addEventListener('keydown', function(e) {
                e.preventDefault();
                
                if (!window.inspector) return;
                
                const result = window.inspector.inspectByCode(e.code);
                let html = `
                    <div class="test-result info">
                        <strong>Key Event:</strong> ${e.code}<br>
                        <strong>Key:</strong> "${e.key}" | <strong>Code:</strong> "${e.code}" | <strong>KeyCode:</strong> ${e.keyCode}
                    </div>
                `;
                
                if (result) {
                    html += '<div class="layout-grid">';
                    for (const layout in result.layouts) {
                        const char = result.layouts[layout] || '‚àÖ';
                        html += `<div class="layout-item">${layout.toUpperCase()}: ${char}</div>`;
                    }
                    html += '</div>';
                } else {
                    html += '<div class="test-result error">No mapping found for this key</div>';
                }
                
                keyResult.innerHTML = html;
            });
        });
        
        // Run tests when page loads
        window.addEventListener('load', function() {
            testLayoutLoading();
            setTimeout(testCharacterInspection, 100);
        });
    </script>
</body>
</html>

