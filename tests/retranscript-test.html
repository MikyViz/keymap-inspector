<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retranscript - Fixed Version Test</title>
</head>
<body>
    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é -->
    <script src="../dist/keymap-inspector.browser.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ KeymapInspector –∑–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
        console.log('üîç KeymapInspector:', typeof KeymapInspector);
        console.log('üîç –†–∞—Å–∫–ª–∞–¥–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã:', {
            en: !!KeymapInspector.en,
            ru: !!KeymapInspector.ru,
            de: !!KeymapInspector.de,
            fr: !!KeymapInspector.fr,
            es: !!KeymapInspector.es,
            ua: !!KeymapInspector.ua,
            he: !!KeymapInspector.he
        });
        
        // –°–æ–∑–¥–∞—ë–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π inspector —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π (–∫–∞–∫ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ)
        if (KeymapInspector.en && KeymapInspector.ru) {
            window.globalInspector = new KeymapInspector({
                en: KeymapInspector.en,
                ru: KeymapInspector.ru,
                de: KeymapInspector.de,
                fr: KeymapInspector.fr,
                es: KeymapInspector.es,
                ua: KeymapInspector.ua,
                he: KeymapInspector.he
            });
            console.log('‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
        } else {
            console.error('‚ùå –†–∞—Å–∫–ª–∞–¥–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
        }
        
        // –í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è convertLayoutSmart (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function convertLayoutSmart(text, targetLayout = 'en') {
            try {
                const inspector = window.globalInspector;
                
                if (!inspector) {
                    console.error('–ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    return text;
                }
                
                console.log('‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä:', inspector);
                
                return Array.from(text).map(char => {
                    try {
                        const result = inspector.inspect(char);
                        console.log(`üîç inspect("${char}"):`, result);
                        
                        if (result && result.layouts && result.layouts[targetLayout]) {
                            const convertedChar = result.layouts[targetLayout];
                            console.log(`‚ú® "${char}" ‚Üí "${convertedChar}" (${targetLayout})`);
                            return convertedChar;
                        }
                        
                        return char;
                    } catch (error) {
                        console.warn(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–º–≤–æ–ª: ${char}`, error);
                        return char;
                    }
                }).join('');
            } catch (error) {
                console.error('KeymapInspector –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', error);
                return text;
            }
        }
    </script>
    
    <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h1>
    
    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h2>–°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏:</h2>
            <div id="status"></div>
        </div>
        
        <div style="background: #fff; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>–¢–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:</h2>
            <div>
                <label for="text">–í–≤–µ–¥–∏—Ç–µ —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç:</label><br>
                <textarea id="text" rows="4" cols="60" placeholder="–ø—Ä–∏–≤–µ—Ç –º–∏—Ä" style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea><br>
                
                <label for="retranscripted">–†–µ–∑—É–ª—å—Ç–∞—Ç (–∞–Ω–≥–ª–∏–π—Å–∫–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞):</label><br>
                <textarea id="retranscripted" rows="4" cols="60" readonly style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa;"></textarea><br>
                
                <button onclick="testConversion()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
        </div>
        
        <div id="testResults" style="margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;"></div>
    </div>
    
    <script>
        function updateStatus() {
            const statusDiv = document.getElementById('status');
            let html = '';
            
            if (typeof KeymapInspector === 'function') {
                html += '<div style="color: green;">‚úÖ KeymapInspector –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
                
                if (KeymapInspector.en && KeymapInspector.ru) {
                    html += '<div style="color: green;">‚úÖ –†–∞—Å–∫–ª–∞–¥–∫–∏ EN –∏ RU –¥–æ—Å—Ç—É–ø–Ω—ã</div>';
                    
                    if (window.globalInspector) {
                        html += '<div style="color: green;">‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω</div>';
                        html += '<div style="color: blue;">üöÄ –í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!</div>';
                    } else {
                        html += '<div style="color: red;">‚ùå –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –Ω–µ —Å–æ–∑–¥–∞–Ω</div>';
                    }
                } else {
                    html += '<div style="color: red;">‚ùå –†–∞—Å–∫–ª–∞–¥–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</div>';
                    html += `<div>EN: ${!!KeymapInspector.en}, RU: ${!!KeymapInspector.ru}</div>`;
                }
            } else {
                html += '<div style="color: red;">‚ùå KeymapInspector –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</div>';
            }
            
            statusDiv.innerHTML = html;
        }
        
        function testConversion() {
            const input = document.getElementById('text').value || '–ø—Ä–∏–≤–µ—Ç –º–∏—Ä';
            const output = document.getElementById('retranscripted');
            const results = document.getElementById('testResults');
            
            if (!window.globalInspector) {
                results.innerHTML = '<div style="color: red;">‚ùå –ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –Ω–µ –≥–æ—Ç–æ–≤!</div>';
                return;
            }
            
            const converted = convertLayoutSmart(input, 'en');
            output.value = converted;
            
            results.innerHTML = `
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:</h3>
                <p><strong>–ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç:</strong> "${input}"</p>
                <p><strong>–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π:</strong> "${converted}"</p>
                <p style="color: green;">‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Å –ø–æ–º–æ—â—å—é keymap-inspector!</p>
                <p style="color: blue;">üí° –¢–µ–ø–µ—Ä—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π npm –ø–∞–∫–µ—Ç–∞!</p>
            `;
            
            console.log('üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è:', input, '‚Üí', converted);
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        setTimeout(updateStatus, 100);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
        setTimeout(() => {
            if (window.globalInspector) {
                document.getElementById('text').value = '–ø—Ä–∏–≤–µ—Ç –º–∏—Ä';
                testConversion();
            }
        }, 500);
    </script>
</body>
</html>

